# Jimflix Scripts ðŸ§¹

This repository contains a collection of automated cleanup scripts and background pollers designed to manage and maintain the **Jimflix** media environment.  

It focuses on:
- Automatically removing **orphaned symlink folders**
- Automatically cleaning up **missing media entries** in the **Riven-DB**
- Periodically cleaning up **Real-Debrid media folders** that are no longer linked to Jimflix
- Structured logging for every operation for easy monitoring

The system works through a **Docker container** that runs both on-startup cleanup routines and **continuous background pollers** to detect changes and fix inconsistencies in your media environment in real time.

> **Goal**: Keep your Plex server, Real-Debrid storage and Riven database in sync, clean, and clutter-freeâ€”automatically.

## Setup Instructions

### 1. Create the base directory for Jimflix Scripts

```bash
sudo mkdir -p /srv/jimflix/jimflix-scripts
sudo chown -R 1000:1000 /srv/jimflix/jimflix-scripts
```

>This is the base directory for **Jimflix Scripts**, containing all configuration files and automation scripts related to Jimflix along with their logs.
---

### 2. Clone this repository

```bash
cd /srv/jimflix/jimflix-scripts
git clone https://github.com/jimmanolias/jimflix-scripts.git .
```

---

### 3. Create the log directory

```bash
sudo mkdir -p /srv/jimflix/jimflix-scripts/logs
sudo chown -R 1000:1000 /srv/jimflix/jimflix-scripts/logs
```

>This directory stores log files generated by the scripts that help with troubleshooting, auditing, and monitoring script activity.

---

### 4. Make scripts executable

```bash
chmod +x /srv/jimflix/jimflix-scripts/entrypoint.sh
chmod +x /srv/jimflix/jimflix-scripts/pollers/*.sh
chmod +x /srv/jimflix/jimflix-scripts/scripts/*.sh
```

>Ensures that all `.sh` files can be executed.

---

### 5. Create and configure the .env file for Jimflix Scripts

Create the `.env` file

```bash
cp /srv/jimflix/jimflix-scripts/.env.example /srv/jimflix/jimflix-scripts/.env
```

Edit the `.env` file to customize your settings:

```bash
nano /srv/jimflix/jimflix-scripts/.env
```


---

### 6. Deploy the Docker stack

```bash
cd /srv/jimflix/jimflix-scripts
docker compose build
docker compose up -d
```

>This builds and launches the container that manages all polling and cleanup automation scripts for Jimflix.

---

## Check the logs

To view the logs of the Jimflix Scripts Docker container, follow these steps:

### 1. View the existing logs

```bash
docker logs jimflix-scripts
```

### 2. View live logs (follow output)

```bash
docker logs -f jimflix-scripts
```

---



## Overview of Jimflix Scripts


### `cleanup-orphaned-rd-symlink-folders.sh`

```bash
/srv/jimflix/jimflix-scripts/scripts/cleanup-orphaned-rd-symlink-folders.sh
```

> Removes symlink folders in the Jimflix media directories that contain only broken symlinks pointing to deleted or missing Real-Debrid media.

---

### `cleanup-riven-db.sh`

```bash
/srv/jimflix/jimflix-scripts/scripts/cleanup-riven-db.sh
```

> Cleans up missing media entries in the Riven-DB database by removing movies, episodes, seasons, and shows that no longer point to existing media files.

---

### `cleanup-riven-1080p-db.sh`

```bash
/srv/jimflix/jimflix-scripts/scripts/cleanup-riven-1080p-db.sh
```

> Performs the same cleanup as `cleanup-riven-db.sh`, but targets the secondary Riven instance (jimflix-riven-addon). It removes media entries in the Riven-1080p-DB database that no longer reference existing media files.

---

### `cleanup-unlinked-rd-media-folders.sh`

```bash
/srv/jimflix/jimflix-scripts/scripts/cleanup-unlinked-rd-media-folders.sh
```

> Removes Real-Debrid media folders that are no longer linked to Jimflix.

